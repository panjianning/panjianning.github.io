var t=Object.defineProperty,e=(e,s,i)=>(((e,s,i)=>{s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i})(e,"symbol"!=typeof s?s+"":s,i),i);const s=function(t){return t+1&-2},i=function(t){return(t+4&-4)-1},r=function(t,e,s){return Math.min(Math.max(t,e),s)};let n={};const a={setColorConverters:function(t){Object.assign(n,t)},rgbToRgb(t,e,s){if(n.rgbToRgb){return n.rgbToRgb([t,e,s])}return[t,e,s]},cmykToRgb:function(t,e,s,i){if(n&&n.cmykToRgb)return n.cmykToRgb([t,e,s,i]);return[r(65535-(t*(255-i)+(i<<8))>>8,0,255),r(65535-(e*(255-i)+(i<<8))>>8,0,255),r(65535-(s*(255-i)+(i<<8))>>8,0,255)]}},h=new TextDecoder("utf-16be");class l{constructor(t){this.data=t,this.dataView=new DataView(t.buffer),this.pos=0}tell(){return this.pos}read(t){const e=this.pos;return this.pos+=t,this.data.subarray(e,this.pos)}seek(t,e=!1){this.pos=e?this.pos+t:t}readString(t){return String.fromCharCode.apply(null,this.read(t)).replace(/\u0000/g,"")}readUnicodeString(t=null){return t||(t=this.readInt()),h.decode(this.read(2*t)).replace(/\u0000/g,"")}readByte(){return this.read(1)[0]}readBoolean(){return 0!==this.readByte()}readSpaceColor(){let t;const e=this.readShort();for(let s=0;s<4;s++)t=this.readShort()>>8;return{colorSpace:e,components:t}}readPathNumber(){const t=this.readByte(),e=this.read(3),s=e[0]<<16|e[1]<<8|e[2];return parseFloat(t,10)+parseFloat(s/Math.pow(2,24),10)}readInt(){const t=this.dataView.getInt32(this.pos);return this.pos+=4,t}readUInt(){const t=this.dataView.getUint32(this.pos);return this.pos+=4,t}readShort(){const t=this.dataView.getInt16(this.pos);return this.pos+=2,t}readUShort(){const t=this.dataView.getUint16(this.pos);return this.pos+=2,t}readFloat(){const t=this.dataView.getFloat32(this.pos);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos);return this.pos+=8,t}readLongLong(){const t=this.read(8);let e=0;for(let s=0;s<8;s++){const i=7-s;e+=t[s]*Math.pow(256,i)}return e}}const o=["Bitmap","GrayScale","IndexedColor","RGBColor","CMYKColor","HSLColor","HSBColor","Multichannel","Duotone","LabColor","Gray16","RGB48","Lab48","CMYK64","DeepMultichannel","Duotone16"];class c{constructor(t){this.file=t,this.sig=null,this.version=null,this.channels=null,this.height=null,this.width=null,this.depth=null,this.mode=null}parse(){if(this.sig=this.file.readString(4),"8BPS"!==this.sig)throw new Error("Invalid file signature detected. Got: "+this.sig+". Expected 8BPS.");this.version=this.file.readUShort(),this.file.seek(6,!0),this.channels=this.file.readUShort(),this.height=this.file.readUInt(),this.width=this.file.readUInt(),this.depth=this.file.readUShort(),this.mode=this.file.readUShort();const t=this.file.readUInt();this.file.seek(t,!0)}get rows(){return this.height}get cols(){return this.height}modeName(){return o[this.mode]}export(){const t={},e=["sig","version","channels","height","width","depth","mode"],s=e.length;for(let i=0;i<s;i++){const s=e[i];t[s]=this[s]}return t}}const d={toBase64(){const t=document.createElement("canvas");t.width=this.width(),t.height=this.height();const e=t.getContext("2d",{willReadFrequently:!0}),s=e.getImageData(0,0,this.width(),this.height()),i=s.data,r=this.pixelData.length;for(let n=0;n<r;n++)i[n]=this.pixelData[n];return e.putImageData(s,0,0),t.toDataURL("image/png")},toPng(){const t=this.toBase64(),e=new Image;return e.width=this.width(),e.height=this.height(),e.src=t,e},saveAsPng(){throw"Not available in the browser. Use toPng() instead."}};let u=class{constructor(t,e,s){if(this.file=t,this.header=e,s&&(this.layer=s,this._width=s.width,this._height=s.height,this.width=function(){return this._width},this.height=function(){return this._height}),this.numPixels=this.width()*this.height(),16===this.depth()&&(this.numPixels*=2),this.calculateLength(),this.pixelData=new Uint8Array(4*this.channelLength),this.layer&&this.layer.mask.size){const t=this.header.width,e=this.header.height,s=this.layer.mask,i=6e6,r=(Math.min(s.right,t)-Math.max(s.left,0))*(Math.min(s.bottom,e)-Math.max(s.top,0));this.maskLength>i&&r/this.maskLength<.5?(s.width=t,s.height=e,s.isSingleChannel=!0,this.maskData=new Uint8Array(t*e)):this.maskData=new Uint8Array(4*this.maskLength)}this.channelData=new Uint8Array(this.length+this.maskLength),this.opacity=1,this.hasMask=!1,this.startPos=this.file.tell(),this.endPos=this.startPos+this.length,this.setChannelsInfo()}setChannelsInfo(){switch(this.mode()){case 1:return this.setGreyscaleChannels();case 3:return this.setRgbChannels();case 4:return this.setCmykChannels()}}_calcAreaByDepth(t){switch(t){case 1:return(this.width()+7)/8*this.height();case 16:return this.width()*this.height()*2;default:return this.width()*this.height()}}calculateLength(){var t,e,s,i;if(this.length=this._calcAreaByDepth(this.depth()),this.channelLength=this.length,this.length*=this.channels(),this.maskLength=0,(null==(e=null==(t=this.layer)?void 0:t.mask)?void 0:e.size)&&(this.maskLength+=this.layer.mask.width*this.layer.mask.height),null==(i=null==(s=this.layer)?void 0:s.mask)?void 0:i.vmask){const{width:t,height:e}=this.layer.mask.vmask;this.maskLength+=t*e}}parse(){this.compression=this.parseCompression(),2!==this.compression&&3!==this.compression?this.parseImageData():this.file.seek(this.endPos)}parseCompression(){return this.file.readShort()}parseImageData(){switch(this.compression){case 0:this.parseRaw();break;case 1:this.parseRLE();break;case 2:case 3:this.parseZip();break;default:this.file.seek(this.endPos)}this.processImageData()}processImageData(){switch(this.mode()){case 1:this.combineGreyscaleChannel();break;case 3:this.combineRgbChannel();break;case 4:this.combineCmykChannel()}this.channelData=null}parseRaw(){this.channelData.set(this.file.read(this.length))}parseRLE(){this.byteCounts=this.parseByteCounts(),this.parseChannelData()}parseByteCounts(){const t=this.channels()*this.height(),e=[];for(let s=0;s<t;s++)1===this.header.version?e.push(this.file.readShort()):e.push(this.file.readInt());return e}parseChannelData(){this.chanPos=0,this.lineIndex=0;const t=this.channels();for(let e=0;e<t;e++)this.decodeRLEChannel(),this.lineIndex+=this.height()}decodeRLEChannel(){const t=this.height();for(let e=0;e<t;e++){const t=this.byteCounts[this.lineIndex+e],s=this.file.tell()+t;for(;this.file.tell()<s;){let t=this.file.read(1)[0];if(t<128){t+=1;const e=this.file.read(t);this.channelData.set(e,this.chanPos),this.chanPos+=t}else if(t>128){t^=255,t+=2;const e=this.file.read(1)[0];this.channelData.fill(e,this.chanPos,this.chanPos+t),this.chanPos+=t}}}}setGreyscaleChannels(){if(this.channelsInfo=[{id:0}],2===this.channels())return this.channelsInfo.push({id:-1})}combineGreyscaleChannel(){for(let t=0;t<this.numPixels;t++){const e=this.channelData[t],s=2===this.channels()?this.channelData[this.channelLength+t]:25;this.pixelData.set([e,e,e,s],4*t)}}setRgbChannels(){if(this.channelsInfo=[{id:0},{id:1},{id:2}],4===this.channels())return this.channelsInfo.push({id:-1})}combineRgbChannel(){const t=this.channelsInfo.map((t=>t.id)).filter((t=>t>=-1));for(let e=0;e<this.numPixels;e++){let s=0,i=0,r=0,n=255;const h=t.length;for(let a=0;a<h;a++){const h=t[a],l=this.channelData[e+this.channelLength*a];switch(h){case-1:n=l;break;case 0:s=l;break;case 1:i=l;break;case 2:r=l}}const[l,o,c]=a.rgbToRgb(s,i,r);this.pixelData.set([l,o,c,n],4*e)}return this.readMaskData(t)}readMaskData(t){if(this.hasMask){let e;const s=this.layer.mask.width*this.layer.mask.height,i=this.channelLength*t.length;if(this.layer.mask.isSingleChannel)return e=new Uint8Array(this.channelData.buffer,i,s),void this.maskData.set(e);let r=0;for(;r<s;)e=this.channelData[r+i],this.maskData.set([0,0,0,e],4*r),r++}}setCmykChannels(){if(this.channelsInfo=[{id:0},{id:1},{id:2},{id:3}],5===this.channels())return this.channelsInfo.push({id:-1})}combineCmykChannel(){const t=this.channelsInfo.map((t=>t.id)).filter((t=>t>=-1));for(let e=0;e<this.numPixels;e++){let s=0,i=0,r=0,n=0,h=255;const l=t.length;for(let a=0;a<l;a++){const l=t[a],o=this.channelData[e+this.channelLength*a];switch(l){case-1:h=o;break;case 0:s=o;break;case 1:i=o;break;case 2:r=o;break;case 3:n=o}}const[o,c,d]=a.cmykToRgb(255-s,255-i,255-r,255-n);this.pixelData.set([o,c,d,h],4*e)}this.readMaskData(t)}width(){return this.header.width}height(){return this.header.height}channels(){return this.header.channels}depth(){return this.header.depth}mode(){return this.header.mode}};var f,p;f=u,p=d,Object.keys(p).forEach((t=>{f.prototype[t]=p[t]}));class g{constructor(t,e){this.obj=t,this.file=e,this.startPos=this.file.tell(),this.loaded=!1,this.loadMethod=null,this.loadArgs=[],this.passthru=[]}now(t,...e){return this.obj[t].apply(this.obj,e),this}later(t,...e){return this.loadMethod=t,this.loadArgs=e,this}ignore(...t){return this.passthru.concat(t),this}get(){const t=function(t){const e=new Set;for(;t&&t.constructor!==Object;){const s=Reflect.ownKeys(t);for(const t of s)e.add(t);t=Reflect.getPrototypeOf(t)}return[...e]}(this.obj);for(const e of t)this[e]||Object.defineProperty(this,e,{get:function(){return this.loaded||this.passthru.includes(e)||this.load(),this.obj[e]}});return this}load(){const t=this.file.tell();this.file.seek(this.startPos),this.obj[this.loadMethod].apply(this.obj,this.loadArgs),this.file.seek(t),this.loaded=!0}}class y{constructor(t){this.file=t,this.data={}}parse(){this.data.class=this.parseClass();const t=this.file.readInt();for(let e=0;e<t;e++){const[t,e]=this.parseKeyItem();this.data[t]=e}return this.data}parseClass(){return{name:this.file.readUnicodeString(),id:this.parseId()}}parseId(){const t=this.file.readInt();return 0===t?this.file.readString(4):this.file.readString(t)}parseKeyItem(){return[this.parseId(),this.parseItem()]}parseItem(t=null){switch(null==t&&(t=this.file.readString(4)),t){case"bool":case"uglg":return this.parseBoolean();case"type":case"GlbC":return this.parseClass();case"Objc":case"GlbO":return new y(this.file).parse();case"doub":return this.parseDouble();case"enum":return this.parseEnum();case"alis":return this.parseAlias();case"Pth":return this.parseFilePath();case"long":return this.parseInteger();case"comp":return this.parseLargeInteger();case"VlLs":return this.parseList();case"ObAr":return this.parseObjectArray();case"tdta":return this.parseRawData();case"obj ":return this.parseReference();case"TEXT":return this.file.readUnicodeString();case"UntF":return this.parseUnitDouble();case"UnFl":return this.parseUnitFloat()}}parseBoolean(){return this.file.readBoolean()}parseDouble(){return this.file.readDouble()}parseInteger(){return this.file.readInt()}parseLargeInteger(){return this.file.readLongLong()}parseIdentifier(){return this.file.readInt()}parseIndex(){return this.file.readInt()}parseOffset(){return this.file.readInt()}parseProperty(){return{class:this.parseClass(),id:this.parseId()}}parseEnum(){return{type:this.parseId(),value:this.parseId()}}parseEnumReference(){return{class:this.parseClass(),type:this.parseId(),value:this.parseId()}}parseAlias(){const t=this.file.readInt();return this.file.readString(t)}parseFilePath(){this.file.readInt();const t=this.file.readString(4);this.file.read("<i");const e=this.file.read("<i");return{sig:t,path:this.file.readUnicodeString(e)}}parseList(){const t=this.file.readInt(),e=[];for(let s=0;s<t;s++)e.push(this.parseItem());return e}parseObjectArray(){throw`Descriptor object array not implemented yet @ ${this.file.tell()}`}parseRawData(){const t=this.file.readInt();return this.file.read(t)}_getReferenceValue(t){switch(t){case"prop":return this.parseProperty();case"Clss":return this.parseClass();case"Enmr":return this.parseEnumReference();case"Idnt":return this.parseIdentifier();case"indx":return this.parseIndex();case"name":return this.file.readUnicodeString();case"rele":return this.parseOffset()}}parseReference(){const t=this.file.readInt(),e=[];for(let s=0;s<t;s++){const t=this.file.readString(4),s=this._getReferenceValue(t);e.push({type:t,value:s})}return e}parseUnitDouble(){const t=this.file.readString(4),e=function(){switch(t){case"#Ang":return"Angle";case"#Rsl":return"Density";case"#Rlt":return"Distance";case"#Nne":return"None";case"#Prc":return"Percent";case"#Pxl":return"Pixels";case"#Mlm":return"Millimeters";case"#Pnt":return"Points"}}(),s=this.file.readDouble();return{id:t,unit:e,value:s}}parseUnitFloat(){const t=this.file.readString(4),e=function(){switch(t){case"#Ang":return"Angle";case"#Rsl":return"Density";case"#Rlt":return"Distance";case"#Nne":return"None";case"#Prc":return"Percent";case"#Pxl":return"Pixels";case"#Mlm":return"Millimeters";case"#Pnt":return"Points"}}(),s=this.file.readFloat();return{id:t,unit:e,value:s}}}class m{constructor(t,e){this.layer=t,this.length=e,this.file=t.file,this.section_end=this.file.tell()+e,this.data={}}skip(){this.file.seek(this.section_end)}parse(){this.skip()}}const _=new TextDecoder("utf-16be"),b=[function(t){return{match:D(/^<<$/,t),parse:function(){x({})}}},function(t){return{match:D(/^>>$/,t),parse:function(){v()}}},function(t){const e=/^\/(\w+) \[$/;return{match:D(e,t),parse:function(){k.push(t.match(e)[1]),x([])}}},function(t){return{match:D(/^]$/,t),parse:function(){v()}}},function(t){const e=/^\/([_A-Z0-9]+)$/i;return{match:D(e,t),parse:function(){k.push(t.match(e)[1])}}},function(t){const e=/^\/([_A-Z0-9]+)\s((.|\r)*)$/i;return{match:D(e,t),parse:function(){const s=t.match(e);var i,r;i=s[1],r=w(s[2]),I[i]=r}}},function(t){const e=/^\[(.*)\]$/;return{match:D(e,t),parse:function(){const s=t.match(e)[1].trim().split(" "),i=[],r=s.length;for(let t=0;t<r;t++)i.push(w(s[t]));return i}}},function(t){return{match:D(/^(true|false)$/,t),parse:function(){return"true"===t}}},function(t){return{match:D(/^-?\d+$/,t),parse:function(){return Number(t)}}},function(t){return{match:D(/^(-?\d*)\.(\d+)$/,t),parse:function(){return Number(t)}}},function(t){const e=/^\(((.|\r)*)\)$/;return{match:D(e,t),parse:function(){const s=t.match(e)[1],i=[],r=s.length;for(let t=0;t<r;t++)i.push(s.charCodeAt(t));return _.decode(new Uint8Array(i))}}}];let S=[],k=[],I=[];const P=function(t){var e;return S=k=I=[],e=function(t){return String.fromCharCode.apply(null,t)}(t),e.split("\n").map((function(t){w(t.replace(/^\t+/g,""))})),I.shift()};function w(t){for(const e in b){const s=new b[e](t);if(s.match)return s.parse()}return t}function D(t,e){return t.test(e)}function x(t){S.push(I),I=t}function v(){const t=S.pop();var e;e=t,"[object Array]"===Object.prototype.toString.call(e)?t.push(I):t[k.pop()]=I,I=t}let L,C;class R extends m{static shouldParse(t){return"TySh"===t}constructor(t,e){super(t,e),this.version=null,this.transform={},this.textVersion=null,this.descriptorVersion=null,this.textData=null,this.engineData=null,this.textValue=null,this.warpVersion=null,this.descriptorVersion=null,this.warpData=null,this.coords={}}parse(){this.version=this.file.readShort(),this.parseTransformInfo(),this.textVersion=this.file.readShort(),this.descriptorVersion=this.file.readInt(),this.textData=new y(this.file).parse(),this.textValue=this.textData["Txt "],this.engineData=P(this.textData.EngineData),this.warpVersion=this.file.readShort(),this.descriptorVersion=this.file.readInt(),this.warpData=new y(this.file).parse();const t=L.length;for(let e=0;e<t;e++){const t=L[e];this.coords[t]=this.file.readInt()}}parseTransformInfo(){const t=C.length;for(let e=0;e<t;e++){const t=C[e];this.transform[t]=this.file.readDouble()}}fonts(){return null==this.engineData?[]:this.engineData.ResourceDict.FontSet.map((function(t){return t.Name}))}lengthArray(){const t=this.engineData.EngineDict.StyleRun.RunLengthArray;return t.reduce(((t,e)=>t+e))-this.textValue.length==1&&(t[t.length-1]=t[t.length-1]-1),t}fontStyles(){return this.engineData.EngineDict.StyleRun.RunArray.map((function(t){return t.StyleSheet.StyleSheetData})).map((function(t){let e;return e=t.FauxItalic?"italic":"normal",e}))}fontWeights(){return this.engineData.EngineDict.StyleRun.RunArray.map((function(t){return t.StyleSheet.StyleSheetData})).map((function(t){let e;return e=t.FauxBold?"bold":"normal",e}))}textDecoration(){return this.engineData.EngineDict.StyleRun.RunArray.map((function(t){return t.StyleSheet.StyleSheetData})).map((function(t){let e;return e=t.Underline?"underline":"none",e}))}leading(){return this.engineData.EngineDict.StyleRun.RunArray.map((function(t){return t.StyleSheet.StyleSheetData})).map((function(t){let e;return e=t.Leading?t.Leading:"auto",e}))}sizes(){return null==this.engineData&&null==this.styles().FontSize?[]:this.styles().FontSize}alignment(){if(null==this.engineData)return[];const t=["left","right","center","justify"];return this.engineData.EngineDict.ParagraphRun.RunArray.map((function(e){return t[Math.min(parseInt(e.ParagraphSheet.Properties.Justification,10),3)]}))}colors(){return null==this.engineData||null==this.styles().FillColor?[[0,0,0,255]]:this.styles().FillColor.map((function(t){const e=t.Values.map((function(t){return Math.round(255*t)}));return e.push(e.shift()),e}))}fillTypes(){return this.styles().FillColor?this.styles().FillColor.map((function(t){return t.Type})):1}styles(){if(null==this.engineData)return{};if(null!=this._styles)return this._styles;const t=this.engineData.EngineDict.StyleRun.RunArray.map((function(t){return t.StyleSheet.StyleSheetData}));return this._styles=t.reduce((function(t,e){for(const s in e){if(!e.hasOwnProperty(s))continue;const i=e[s];t[s]||(t[s]=[]),t[s].push(i)}return t}),{})}toCSS(){const t={"font-family":this.fonts().join(", "),"font-size":`${this.sizes()[0]}pt`,color:`rgba(${this.colors()[0].join(", ")})`,"text-align":this.alignment()[0]},e=[];for(const s in t){const i=t[s];null!=i&&e.push(`${s}: ${i};`)}return e.join("\n")}export(){return{value:this.textValue,font:{lengthArray:this.lengthArray(),styles:this.fontStyles(),weights:this.fontWeights(),names:this.fonts(),sizes:this.sizes(),colors:this.colors(),alignment:this.alignment(),textDecoration:this.textDecoration(),leading:this.leading()},left:this.coords.left,top:this.coords.top,right:this.coords.right,bottom:this.coords.bottom,transform:this.transform}}}C=["xx","xy","yx","yy","tx","ty"],L=["left","top","right","bottom"];const A=["other","open folder","closed folder","bounding section divider"];class M{constructor(t){this.file=t,this.recordType=null}parse(){switch(this.recordType=this.file.readShort(),this.recordType){case 0:case 3:this._readPathRecord();break;case 1:case 2:case 4:case 5:this._readBezierPoint();break;case 7:this._readClipboardRecord();break;case 8:this._readInitialFill();break;default:this.file.seek(24,!0)}}export(){const t=(()=>{switch(this.recordType){case 0:case 3:return{numPoints:this.numPoints,operation:this.operation};case 1:case 2:case 4:case 5:return{linked:this.linked,closed:1===this.recordType||2===this.recordType,preceding:{vert:this.precedingVert,horiz:this.precedingHoriz},anchor:{vert:this.anchorVert,horiz:this.anchorHoriz},leaving:{vert:this.leavingVert,horiz:this.leavingHoriz}};case 7:return{clipboard:{top:this.clipboardTop,left:this.clipboardLeft,bottom:this.clipboardBottom,right:this.clipboardRight,resolution:this.clipboardResolution}};case 8:return{initialFill:this.initialFill};default:return{}}})();return t.recordType=this.recordType,t}isBezierPoint(){const t=this.recordType;return 1===t||2===t||4===t||5===t}_readPathRecord(){this.numPoints=this.file.readShort(),this.operation=this.file.readShort(),this.file.seek(20,!0)}_readBezierPoint(){const t=this.recordType;this.linked=1===t||4===t,this.precedingVert=this.file.readPathNumber(),this.precedingHoriz=this.file.readPathNumber(),this.anchorVert=this.file.readPathNumber(),this.anchorHoriz=this.file.readPathNumber(),this.leavingVert=this.file.readPathNumber(),this.leavingHoriz=this.file.readPathNumber()}_readClipboardRecord(){this.clipboardTop=this.file.readPathNumber(),this.clipboardLeft=this.file.readPathNumber(),this.clipboardBottom=this.file.readPathNumber(),this.clipboardRight=this.file.readPathNumber(),this.clipboardResolution=this.file.readPathNumber(),this.file.seek(4,!0)}_readInitialFill(){this.initialFill=this.file.readShort(),this.file.seek(22,!0)}}class F extends m{static shouldParse(t){return"lnk2"===t}constructor(t,e){super(t,e)}parse(){const t=this.file.tell()+this.length;for(this.files=[];this.file.tell()<t;){const t={};this.file.seek(4,!0);const e=1+i(this.file.readInt())+this.file.tell(),s=this.file.readString(4),r=this.file.readInt();t.uuid=this.file.readString(this.file.readByte()),t.fileName=this.file.readUnicodeString(),t.fileType=this.file.readString(4),t.creator=this.file.readString(4),this.file.seek(4,!0),t.datasize=this.file.readInt(),t.openFile=this.file.readBoolean(),!0===t.openFile&&(this.file.seek(4,!0),t.openFile=new y(this.file).parse()),"liFD"===s&&(t.fileData=this.file.read(t.datasize)),r>=5&&(t.childId=this.file.readUnicodeString()),r>=6&&(t.modTime=this.file.readDouble()),r>=7&&(t.lockedState=this.file.readBoolean()),this.files.push(t),this.file.seek(e)}return this.file.seek(t),this.files}}const B={artboard:class extends m{static shouldParse(t){return"artb"===t}parse(){return this.file.seek(4,!0),this.data=new y(this.file).parse(),this.data}export(){return{coords:{left:this.data.artboardRect.Left,top:this.data.artboardRect["Top "],right:this.data.artboardRect.Rght,bottom:this.data.artboardRect.Btom}}}},blendClippingElements:class extends m{static shouldParse(t){return"clbl"===t}parse(){this.enabled=this.file.readBoolean(),this.file.seek(3,!0)}},blendInteriorElements:class extends m{static shouldParse(t){return"infx"===t}parse(){this.enabled=this.file.readBoolean(),this.file.seek(3,!0)}},fillOpacity:class extends m{static shouldParse(t){return"iOpa"===t}parse(){const t=this.file.readByte(),e=Math.round(100*t/255);this.data.opacity=e,this.data.unit="Percent"}},gradientFill:class extends m{static shouldParse(t){return"GdFl"===t}parse(){return this.file.seek(4,!0),this.data=new y(this.file).parse(),this.data}},layerId:class extends m{constructor(t,e){super(t,e),this.pos=this.file.tell()}static shouldParse(t){return"lyid"===t}parse(){const t=this.file.tell();return this.file.seek(this.pos),this.id=this.file.readInt(),this.file.seek(t),this.id}},layerNameSource:class extends m{static shouldParse(t){return"lnsr"===t}parse(){return this.id=this.file.readString(4),this.id}},legacyTypetool:class extends R{static shouldParse(t){return"tySh"===t}constructor(t,e){super(t,e),this.transform={},this.faces=[],this.styles=[],this.lines=[],this.type=0,this.scalingFactor=0,this.characterCount=0,this.horzPlace=0,this.vertPlace=0,this.selectStart=0,this.selectEnd=0,this.color=null,this.antialias=null}parse(){this.file.seek(2,!0),this.parseTransformInfo(),this.file.seek(2,!0);const t=this.file.readShort();for(let i=0;i<t;i++){const t={};t.mark=this.file.readShort(),t.fontType=this.file.readInt(),t.fontName=this.file.readString(this.file.readByte()),t.fontFamilyName=this.file.readString(this.file.readByte()),t.fontStyleName=this.file.readString(this.file.readByte()),t.script=this.file.readShort(),t.numberAxesVector=this.file.readInt(),t.vector=[];for(let e=0;e<t.numberAxesVector;e++)t.vector.push(this.file.readInt());this.faces.push(t)}const e=this.file.readShort();for(let i=0;i<e;i++){const t={};t.mark=this.file.readShort(),t.faceMark=this.file.readShort(),t.size=this.file.readInt(),t.tracking=this.file.readInt(),t.kerning=this.file.readInt(),t.leading=this.file.readInt(),t.baseShift=this.file.readInt(),t.autoKern=this.file.readBoolean(),this.file.seek(1,!0),t.rotate=this.file.readBoolean(),this.styles.push(t)}this.type=this.file.readShort(),this.scalingFactor=this.file.readInt(),this.characterCount=this.file.readInt(),this.horzPlace=this.file.readInt(),this.vertPlace=this.file.readInt(),this.selectStart=this.file.readInt(),this.selectEnd=this.file.readInt();const s=this.file.readShort();for(let i=0;i<s;i++){const t={};t.charCount=this.file.readInt(),t.orientation=this.file.readShort(),t.alignment=this.file.readShort(),t.actualChar=this.file.readShort(),t.style=this.file.readShort(),this.lines.push(t)}this.color=this.file.readSpaceColor(),this.antialias=this.file.readBoolean()}},locked:class extends m{static shouldParse(t){return"lspf"===t}constructor(t,e){super(t,e),this.transparencyLocked=!1,this.compositeLocked=!1,this.positionLocked=!1,this.allLocked=!1}parse(){const t=this.file.readInt();this.transparencyLocked=(1&t)>0||-2147483648===t,this.compositeLocked=(2&t)>0||-2147483648===t,this.positionLocked=(4&t)>0||-2147483648===t,this.allLocked=this.transparencyLocked&&this.compositeLocked&&this.positionLocked}},metadata:class extends m{static shouldParse(t){return"shmd"===t}parse(){this.data={};const t=this.file.readInt();for(let e=0;e<t;e++){this.file.seek(4,!0);const t=this.file.readString(4);this.file.readByte(),this.file.seek(3,!0);const e=this.file.readInt(),s=this.file.tell()+e;if(["cust","cmls","extn","mlst","tmln"].includes(t)){let e=this.file.readInt();16!==e&&(e=this.file.readInt()),16===e&&(this.data[t]=new y(this.file).parse())}this.file.seek(s)}}},name:class extends m{static shouldParse(t){return"luni"===t}parse(){const t=this.file.tell();return this.data=this.file.readUnicodeString(),this.file.seek(t+this.length),this}},nestedSectionDivider:class extends m{static shouldParse(t){return"lsdk"===t}constructor(t,e){super(t,e),this.isFolder=!1,this.isHidden=!1}parse(){switch(this.file.readInt()){case 1:case 2:return this.isFolder=!0;case 3:return this.isHidden=!0}}},objectEffects:class extends m{static shouldParse(t){return"lfx2"===t||"lmfx"===t}parse(){return this.file.seek(8,!0),this.data=new y(this.file).parse(),this.data}},sectionDivider:class extends m{static shouldParse(t){return"lsct"===t}constructor(t,e){super(t,e),this.isFolder=!1,this.isHidden=!1,this.layerType=null,this.blendMode=null,this.subType=null}parse(){const t=this.file.readInt();switch(this.layerType=A[t],t){case 1:case 2:this.isFolder=!0;break;case 3:this.isHidden=!0}this.length>=12&&(this.file.seek(4,!0),this.blendMode=this.file.readString(4),this.length>=16&&(this.subType=0===this.file.readInt()?"normal":"scene group"))}},typeTool:R,vectorMask:class extends m{static shouldParse(t){return"vmsk"===t||"vsms"===t}constructor(t,e){super(t,e),this.invert=null,this.notLink=null,this.disable=null,this.paths=[]}parse(){this.file.seek(4,!0);const t=this.file.readInt();this.invert=(1&t)>0,this.notLink=(2&t)>0,this.disable=(4&t)>0;const e=(this.length-10)/26;for(let s=0;s<e;s++){const t=new M(this.file);t.parse(),this.paths.push(t)}}export(){return{invert:this.invert,notLink:this.notLink,disable:this.disable,paths:this.paths.map((t=>t.export()))}}},vectorOrigination:class extends m{static shouldParse(t){return"vogk"===t}parse(){return this.file.seek(8,!0),this.data=new y(this.file).parse(),this.data}},vectorStroke:class extends m{static shouldParse(t){return"vstk"===t}parse(){return this.file.seek(4,!0),this.data=new y(this.file).parse(),this.data}},vectorStrokeContent:class extends m{static shouldParse(t){return"vscg"===t}parse(){return this.file.seek(8,!0),this.data=new y(this.file).parse(),this.data}},placedLayer:class extends m{static shouldParse(t){return"PlLd"===t}constructor(t,e){super(t,e),this.Trnf=[]}parse(){this.identifier=this.file.readString(this.file.readByte()),this.version=this.file.readInt();const t=s(this.file.readByte());return this.Idnt=this.file.readString(t),this.PgNm=this.file.parseInt(),this.totalPages=this.file.parseInt(),this.Annt=this.file.readInt(),this.Type=this.file.readInt(),this.parseTransformInfo(),this.warpValue=this.file.readInt(),this.file.seek(4,!0),this.warpData=new y(this.file).parse(),this}parseTransformInfo(){for(let t=0;t<8;t++)this.Trnf.push(this.file.readDouble())}},linkedLayer:F,smartObject:class extends m{static shouldParse(t){return"SoLd"===t}constructor(t,e){super(t,e)}parse(){return this.identifier=this.file.readString(this.file.readByte()),this.version=this.file.readInt(),this.file.seek(4,!0),this.data=new y(this.file).parse(),this}},exposure:class extends m{constructor(t,e){super(t,e),this.pos=this.file.tell()}static shouldParse(t){return"expA"===t}parse(){const t=this.file.tell();return this.file.seek(this.pos),this.version=this.file.readShort(),this.exposure=this.file.readFloat(),this.offset=this.file.readFloat(),this.gamma=this.file.readFloat(),this.file.seek(t),{version:this.version,exposure:this.exposure,offset:this.offset,gamma:this.gamma}}},pattern:class extends m{static shouldParse(t){return"PtFl"===t}parse(){this.data="调节图层:PtFl"}},brightnessContrast:class extends m{static shouldParse(t){return"brit"===t}parse(){this.data="调节图层:brit"}},levels:class extends m{static shouldParse(t){return"levl"===t}parse(){this.data="调节图层:levl"}},curves:class extends m{static shouldParse(t){return"curv"===t}parse(){this.data="调节图层:curv"}},hue2:class extends m{static shouldParse(t){return"hue2"===t}parse(){this.data="调节图层:hue2"}},colorBalance:class extends m{static shouldParse(t){return"blnc"===t}parse(){this.data="调节图层:blnc"}},blackWhite:class extends m{static shouldParse(t){return"blwh"===t}parse(){this.data="调节图层:blwh"}},photoFilter:class extends m{static shouldParse(t){return"phfl"===t}parse(){this.data="调节图层:phfl"}},colorLookup:class extends m{static shouldParse(t){return"clrL"===t}parse(){this.data="调节图层:clrL"}},invert:class extends m{static shouldParse(t){return"nvrt"===t}parse(){this.data="调节图层:nvrt"}},threshold:class extends m{static shouldParse(t){return"thrs"===t}parse(){this.data="调节图层:thrs"}},gradientMap:class extends m{static shouldParse(t){return"grdm"===t}parse(){this.data="调节图层:grdm"}},selectiveColor:class extends m{static shouldParse(t){return"selc"===t}parse(){this.data="调节图层:selc"}},solidColor:class extends m{static shouldParse(t){return"SoCo"===t}constructor(t,e){super(t,e),this.r=this.g=this.b=0}parse(){this.file.seek(4,!0),this.data=new y(this.file).parse(),this.r=Math.round(this.colorData()["Rd  "]),this.g=Math.round(this.colorData()["Grn "]),this.b=Math.round(this.colorData()["Bl  "])}colorData(){return this.data["Clr "]}color(){return[this.r,this.g,this.b]}},channelMixer:class extends m{static shouldParse(t){return"mixr"===t}parse(){this.data="调节图层:mixr"}},posterize:class extends m{static shouldParse(t){return"post"===t}parse(){this.file.seek(4,!0),this.data="调节图层:post"}},vibrance:class extends m{static shouldParse(t){return"vibA"===t}parse(){this.data="调节图层:vibA"}}},T=["LMsk","Lr16","Lr32","Layr","Mt16","Mt32","Mtrn","Alph","FMsk","Ink2","FEid","FXid","PxSD"];function U(){for(;this.file.tell()<this.layerEnd;){this.file.seek(4,!0);const t=this.file.readString(4);let e;if(e=2===this.header.version&&T.includes(t)?s(this.file.readLongLong()):s(this.file.readInt()),this.file.tell(),e<=0)continue;let i=!1;for(const s in B){const r=B[s];if(!r.shouldParse(t))continue;const n=new r(this,e);if(this.externalFiles&&"lnk2"===t){this.externalFiles.push(n.parse());break}this.adjustments[s]=new g(n,this.file).now("skip").later("parse").get(),null==this[s]&&(this[s]=()=>this.adjustments[s]),this.infoKeys.push(t),i=!0;break}i||this.file.seek(e,!0)}}const E={norm:"normal",dark:"darken",lite:"lighten",hue:"hue",sat:"saturation",colr:"color",lum:"luminosity",mul:"multiply",scrn:"screen",diss:"dissolve",over:"overlay",hLit:"hard_light",sLit:"soft_light",diff:"difference",smud:"exclusion",div:"color_dodge",idiv:"color_burn",lbrn:"linear_burn",lddg:"linear_dodge",vLit:"vivid_light",lLit:"linear_light",pLit:"pin_light",hMix:"hard_mix",pass:"passthru",dkCl:"darker_color",lgCl:"lighter_color",fsub:"subtract",fdiv:"divide"};class j{constructor(t){this.file=t,this.blendKey=null,this.opacity=null,this.clipping=null,this.clipped=null,this.flags=null,this.blendingMode=null,this.visible=null}parse(){this.file.seek(4,!0),this.blendKey=this.file.readString(4).trim(),this.opacity=this.file.readByte(),this.clipping=this.file.readByte(),this.flags=this.file.readByte(),this.blendingMode=E[this.blendKey],this.clipped=1===this.clipping,this.visible=!((2&this.flags)>0),this.file.seek(1,!0)}get mode(){return this.blendingMode}opacityPercentage(){return 100*this.opacity/255}}class O{constructor(t,e){this.file=t,this.hasRealUserSuppliedLayerMask=e,this.top=0,this.right=0,this.bottom=0,this.left=0}parse(){if(this.size=this.file.readInt(),0===this.size)return this;const t=this.file.tell()+this.size;if(this.top=this.file.readInt(),this.left=this.file.readInt(),this.bottom=this.file.readInt(),this.right=this.file.readInt(),this.defaultColor=this.file.readByte(),this.flags=this.file.readByte(),this.relative=0==(this.flags>>0&1),this.isEnabled=0==(this.flags>>1&1),this.disabled=!this.isEnabled,this.invert=1==(this.flags>>3&1),this.hasParam=this.flags>>4&1,this.external=this.hasParam,this.hasParam){let t=255,e=0,s=255,i=0;this.hasRealUserSuppliedLayerMask&&this.readRealUserSuppliedLayerMask();const r=this.file.tell(),n=this.file.readByte();n>>0&1&&(t=this.file.readByte()),n>>1&1&&(e=this.file.readDouble()),n>>2&1&&(s=this.file.readByte()),n>>3&1&&(i=this.file.readDouble()),1==(this.file.tell()-r&1)&&this.file.readByte(),this.maskParameters=[t,e,s,i]}else 20===this.size?this.file.seek(2,!0):this.readRealUserSuppliedLayerMask();return this.width=this.right-this.left,this.height=this.bottom-this.top,this.file.seek(t),this}readRealUserSuppliedLayerMask(){const t=this.file.readByte(),e=this.file.readByte(),s=this.file.readInt(),i=this.file.readInt(),r=this.file.readInt(),n=this.file.readInt(),a=n-i,h=r-s;this.vmask={relative:0==(t>>0&1),isEnabled:0==(t>>1&1),invert:1==(t>>3&1),hasParam:t>>4&1,color:e,top:s,left:i,bottom:r,right:n,width:a,height:h}}export(){return 0===this.size?{}:{top:this.top,left:this.left,bottom:this.bottom,right:this.right,width:this.width,height:this.height,defaultColor:this.defaultColor,relative:this.relative,disabled:this.disabled,invert:this.invert,padding:this.padding,external:this.external}}}class N extends u{constructor(t,e,s){super(t,e,s),this.layer=s,this._width=this.layer.width,this._height=this.layer.height,this.width=function(){return this._width},this.height=function(){return this._height},this.channelsInfo=this.layer.channelsInfo,this.hasMask=this.channelsInfo.some((t=>t.id<-1)),this.opacity=this.layer.opacity/255}skip(){const t=this.channelsInfo,e=t.length;for(let s=0;s<e;s++){const e=t[s];this.file.seek(e.length,!0)}}channels(){return this.layer.channels}parse(){var t;this.chanPos=0;const e=this.channelsInfo,s=e.length;for(let i=0;i<s;i++){const s=e[i];if(s.length<=0){this.parseCompression();continue}if(this.chan=s,s.id<-1){if(this._width=this.layer.mask.width,this._height=this.layer.mask.height,-2===s.id){const{width:t,height:e}=this.layer.mask;if(!t||!e)throw new Error("Incorrect layer mask size");this._width=t,this._height=e}if(-3===s.id){const{width:e,height:s}=null==(t=this.layer.mask)?void 0:t.vmask;if(!e||!s)throw new Error("Incorrect vector mask size");this._width=e,this._height=s}}else this._width=this.layer.width,this._height=this.layer.height;this.length=this._width*this._height;const r=this.file.tell();this.parseImageData();this.file.tell()!==r+this.chan.length&&this.file.seek(r+this.chan.length)}this._width=this.layer.width,this._height=this.layer.height,this.processImageData()}parseImageData(){switch(this.compression=this.parseCompression(),this.compression){case 0:this.parseRaw();break;case 1:this.parseRLE();break;case 2:case 3:this.parseZip();break;default:this.file.seek(this.endPos)}}parseRaw(){const t=this.chanPos+this.chan.length-2;for(let e=this.chanPos;e<t;e++)this.channelData[e]=this.file.readByte();this.chanPos+=this.chan.length-2}parseByteCounts(){const t=this.height(),e=[];for(let s=0;s<t;s++)1===this.header.version?e.push(this.file.readShort()):e.push(this.file.readInt());return e}parseChannelData(){this.lineIndex=0,this.decodeRLEChannel()}}let z=class{constructor(t,e){this.file=t,this.header=e,this.mask={},this.blendingRanges={},this.adjustments={},this.channelsInfo=[],this.blendMode={},this.groupLayer=null,this.infoKeys=[],Object.defineProperty(this,"name",{get:function(){return null!=this.adjustments.name?this.adjustments.name.data:this.legacyName}})}parse(){this.parsePositionAndChannels(),this.parseBlendModes();const t=this.file.readInt();return this.layerEnd=this.file.tell()+t,this.hasRealUserSuppliedLayerMask=this.channelsInfo.some((t=>-3===t.id)),this.parseMaskData(),this.parseBlendingRanges(),this.parseLegacyLayerName(),this.parseLayerInfo(),this.file.seek(this.layerEnd),this}export(){return{name:this.name,top:this.top,right:this.right,bottom:this.bottom,left:this.left,width:this.width,height:this.height,opacity:this.opacity,visible:this.visible,clipped:this.clipped,mask:this.mask.export()}}parsePositionAndChannels(){this.top=this.file.readInt(),this.left=this.file.readInt(),this.bottom=this.file.readInt(),this.right=this.file.readInt(),this.channels=this.file.readShort(),this.rows=this.height=this.bottom-this.top,this.cols=this.width=this.right-this.left;for(let t=0;t<this.channels;t++){const t=this.file.readShort();let e;e=1===this.header.version?this.file.readInt():this.file.readLongLong(),this.channelsInfo.push({id:t,length:e})}}parseBlendModes(){this.blendMode=new j(this.file),this.blendMode.parse(),this.opacity=this.blendMode.opacity,this.visible=this.blendMode.visible,this.clipped=this.blendMode.clipped}hidden(){return!this.visible}blendingMode(){return this.blendMode.blendingMode}parseMaskData(){return this.mask=new O(this.file,this.hasRealUserSuppliedLayerMask),this.mask.parse(),this.mask}parseBlendingRanges(){const t=this.file.readInt();if(0===t)return;this.blendingRanges.grey={source:{black:[this.file.readByte(),this.file.readByte()],white:[this.file.readByte(),this.file.readByte()]},dest:{black:[this.file.readByte(),this.file.readByte()],white:[this.file.readByte(),this.file.readByte()]}};const e=(t-8)/8;this.blendingRanges.channels=[];for(let s=0;s<e;s++)this.blendingRanges.channels.push({source:{black:[this.file.readByte(),this.file.readByte()],white:[this.file.readByte(),this.file.readByte()]},dest:{black:[this.file.readByte(),this.file.readByte()],white:[this.file.readByte(),this.file.readByte()]}})}parseLegacyLayerName(){const t=i(this.file.readByte());return this.legacyName=this.file.readString(t),this.legacyName}parseLayerInfo(){U.call(this)}isFolder(){return null!=this.adjustments.sectionDivider?this.adjustments.sectionDivider.isFolder:null!=this.adjustments.nestedSectionDivider?this.adjustments.nestedSectionDivider.isFolder:"<Layer group>"===this.name}isFolderEnd(){return null!=this.adjustments.sectionDivider?this.adjustments.sectionDivider.isHidden:null!=this.adjustments.nestedSectionDivider?this.adjustments.nestedSectionDivider.isHidden:"</Layer group>"===this.name}parseChannelImage(){const t=new N(this.file,this.header,this);this.image=new g(t,this.file).now("skip").later("parse").get()}};function V(t){return 9===t||10===t||32===t}function G(t,e,s){let i="";for(let r=0;r<s;r++)i+=String.fromCharCode(t[e+r]);return i}function H(t,e,s){const i=e,r={type:"",size:0,value:0};for(;V(t[e]);)e++;if(60===t[e])r.type="Object",r.value={},e=function(t,e,s){for(;60!==t[s];)s++;return K(t,e,s+=2)}(t,r.value,e);else if(40===t[e])if(r.type="String",41===t[++e])r.value="e",e++;else{let s=e+=2;for(;41!==t[s]||92===t[s-1];)s+=1;r.value="s"+function(t,e,s){const i=[];let r="";for(;e<s;){const s=t[e++];92===s?i.push(t[e++]):i.push(s)}for(let n=0;n<i.length;n+=2)r+=String.fromCharCode(i[n]<<8|i[n+1]);return r}(t,e,s),e=s+2}else if(91===t[e]){for(e++,r.value=[],r.type="Array";V(t[e]);)e++;for(;93!==t[e];){const s=H(t,e);if(-1===s)return-1;for(r.value.push(s.value),e+=s.size,delete s.size;V(t[e]);)e++}e++}else{let s=e;for(;!V(t[s]);)s++;const i=G(t,e,s-e),n=parseFloat(i);if(isNaN(n)||-1===i.indexOf("."))if(isNaN(n)||-1!==i.indexOf("."))if("true"===i||"false"===i)r.type="Boolean",r.value="true"===i;else if("/"===i.charAt(0))r.type="BString",r.value=i;else{if("NaN"!==i&&"undefined"!==i)throw"e";r.type="Float",r.value="f0"}else r.type="Integer",r.value="i"+parseInt(i);else r.type="Float",r.value="f"+parseFloat(i);e=s+1}return r.size=e-i,r}function K(t,e,s){for(;;){for(;V(t[s])||0===t[s];)s++;if(s>=t.length)break;if(47!==t[s]){if(62===t[s]){s+=2;break}t[s];throw s++,"e"}{let i=++s;for(;!V(t[i]);)i++;const r=G(t,s,i-s),n=H(t,s=i+1);e["_"+r]=n.value,s+=n.size}}return s}const W={_Color:[0,{_Type:[0],_Values:[1]}],_CAIKnownStyleID:[5],_StreamTag:[99]},$={_Font:[0],_FontSize:[1],_FauxBold:[2],_FauxItalic:[3],_AutoLeading:[4],_Leading:[5],_HorizontalScale:[6],_VerticalScale:[7],_Tracking:[8],_BaselineShift:[9],_CharacterRotation:[10],_AutoKern:[11],_FontCaps:[12],_FontBaseline:[13],_FontOTPosition:[14],_StrikethroughPosition:[15],_UnderlinePosition:[16],_UnderlineOffset:[17],_Ligatures:[18],_DiscretionaryLigatures:[19],_ContextualLigatures:[20],_AlternateLigatures:[21],_OldStyle:[22],_Fractions:[23],_Ordinals:[24],_Swash:[25],_Titling:[26],_ConnectionForms:[27],_StylisticAlternates:[28],_Ornaments:[29],_FigureStyle:[30],_ProportionalMetrics:[31],_Kana:[32],_Italics:[33],_Ruby:[34],_BaselineDirection:[35],_Tsume:[36],_StyleRunAlignment:[37],_Language:[38],_JapaneseAlternateFeature:[39],_EnableWariChu:[40],_WariChuLineCount:[41],_WariChuLineGap:[42],_WariChuSubLineAmount:[43,{_WariChuSubLineScale:[0]}],_WariChuWidowAmount:[44],_WariChuOrphanAmount:[45],_WariChuJustification:[46],_TCYUpDownAdjustment:[47],_TCYLeftRightAdjustment:[48],_LeftAki:[49],_RightAki:[50],_JiDori:[51],_NoBreak:[52],_FillColor:[53,W],_StrokeColor:[54,W],_Blend:[55,{_1:[1],_3:[3],_Knockout:[4],_StreamTag:[99]}],_FillFlag:[56],_StrokeFlag:[57],_FillFirst:[58],_FillOverPrint:[59],_StrokeOverPrint:[60],_LineCap:[61],_LineJoin:[62],_LineWidth:[63],_MiterLimit:[64],_LineDashOffset:[65],_LineDashArray:[66],_Type1EncodingNames:[67],_Kashidas:[68],_DirOverride:[69],_DigitSet:[70],_DiacVPos:[71],_DiacXOffset:[72],_DiacYOffset:[73],_OverlapSwash:[74],_JustificationAlternates:[75],_StretchedAlternates:[76],_FillVisibleFlag:[77],_StrokeVisibleFlag:[78],_FillBackgroundColor:[79,W],_FillBackgroundFlag:[80],_UnderlineStyle:[81],_DashedUnderlineGapLength:[82],_DashedUnderlineDashLength:[83],_SlashedZero:[84],_StylisticSets:[85],_CustomFeature:[86,{_StreamTag:[99]}],_MarkYDistFromBaseline:[87],_AutoMydfb:[88],_RefFontSize:[89],_FontSizeRefType:[90],_92:[92],_93:[93]},J={_Justification:[0],_FirstLineIndent:[1],_StartIndent:[2],_EndIndent:[3],_SpaceBefore:[4],_SpaceAfter:[5],_DropCaps:[6],_AutoLeading:[7],_LeadingType:[8],_AutoHyphenate:[9],_HyphenatedWordSize:[10],_PreHyphen:[11],_PostHyphen:[12],_ConsecutiveHyphens:[13],_Zone:[14],_HyphenateCapitalized:[15],_HyphenationPreference:[16],_WordSpacing:[17],_LetterSpacing:[18],_GlyphSpacing:[19],_SingleWordJustification:[20],_Hanging:[21],_AutoTCY:[22],_KeepTogether:[23],_BurasagariType:[24],_KinsokuOrder:[25],_Kinsoku:[27],_KurikaeshiMojiShori:[26],_MojiKumiTable:[28],_EveryLineComposer:[29],_TabStops:[30],_DefaultTabWidth:[31],_DefaultStyle:[32,$],_ParagraphDirection:[33],_JustificationMethod:[34],_ComposerEngine:[35],_ListStyle:[36],_ListTier:[37],_ListSkip:[38],_ListOffset:[39],_KashidaWidth:[40]},Y={_Name:[0],_Features:[5,J],_Parent:[6],_UUID:[97]},Q={_Name:[0],_Parent:[5],_Features:[6,$],_UUID:[97]},Z={_98:[98,{_0:[0]}],_DocumentResources:[0,{_0:[0],_FontSet:[1,{_Resources:[0,{_Resource:[0,{_StreamTag:[99],_Identifier:[0,{_Name:[0],_ScriptType:[1],_Type:[2],_Synthetic:[3],_4:[4],_MMAxis:[5]}],_UUID:[97]}]}],_DisplayList:[1,{_Resource:[0]}]}],_MojiKumiCodeToClassSet:[2,{_Resources:[0,{_Resource:[0,{_Name:[0],_Members:[5],_UUID:[97]}]}],_DisplayList:[1,{_Resource:[0]}]}],_MojiKumiTableSet:[3,{_Resources:[0,{_Resource:[0,{_Name:[0],_Members:[5,{_CodeToClass:[0],_AutoTsume:[1,{_TsumeMappings:[0,{_Before:[0],_After:[1],_Code:[2]}]}],_Table:[2,{_DataArray:[0,{_SparseArray:[0,{_Index:[0],_Elements:[1,{_P:[0],_Data:[1,{_A:[0,{_R:[0],_P:[1]}],_B:[1,{_R:[0],_P:[1]}]}]}]}]}]}],_PredefinedTag:[3]}],_UUID:[97]}]}],_DisplayList:[1,{_Resource:[0]}]}],_KinsokuSet:[4,{_Resources:[0,{_Resource:[0,{_Name:[0],_Data:[5,{_NoStart:[0],_NoEnd:[1],_Keep:[2],_Hanging:[3],_PredefinedTag:[4]}],_UUID:[97]}]}],_DisplayList:[1,{_Resource:[0]}]}],_StyleSheetSet:[5,{_Resources:[0,{_Resource:[0,Q]}],_DisplayList:[1,{_Resource:[0]}]}],_ParagraphSheetSet:[6,{_Resources:[0,{_Resource:[0,Y]}],_DisplayList:[1,{_Resource:[0]}]}],_7:[7,{_Resources:[0,{_Resource:[0,{_0:[0,{_0:[0],_1:[1,{_0:[0]}]}],_1:[1]}]}]}],_TextFrameSet:[8,{_Resources:[0,{_Resource:[0,{_0:[0],_Bezier:[1,{_Points:[0]}],_Data:[2,{_Type:[0],_LineOrientation:[1],_FrameMatrix:[2],_4:[4],_TextOnPathTRange:[6],_RowGutter:[7],_ColumnGutter:[8],_9:[9],_FirstBaselineAlignment:[10,{_Flag:[0],_Min:[1]}],_PathData:[11,{_1:[1],_Reversed:[0],_2:[2],_3:[3],_Spacing:[4],_5:[5],_6:[6],_7:[7],_18:[18]}],_12:[12],_13:[13]}],_3:[3,{_0:[0]}],_UUID:[97]}]}]}],_ListStyleSet:[9,{_Resources:[0,{_Resource:[0,{_Name:[0],_LevelStyle:[5,{_IndentUnits:[0],_TextIndent:[1],_LabelIndent:[2],_LabelAlignment:[3],_SequenceGenerator:[5,{_Prefix:[0],_Postfix:[1],_2:[2],_CaseType:[3],_Bullet:[9],_StreamTag:[99]}],_Font:[6],_7:[7]}],_PredefinedTag:[6],_UUID:[97]}]}],_DisplayList:[1,{_Resource:[0]}]}]}],_DocumentObjects:[1,{_DocumentSettings:[0,{_HiddenGlyphFont:[0,{_AlternateGlyphFont:[0],_WhitespaceCharacterMapping:[1,{_WhitespaceCharacter:[0],_AlternateCharacter:[1]}]}],_NormalStyleSheet:[1],_NormalParagraphSheet:[2],_SuperscriptSize:[3],_SuperscriptPosition:[4],_SubscriptSize:[5],_SubscriptPosition:[6],_SmallCapSize:[7],_UseSmartQuotes:[8],_SmartQuoteSets:[9,{_Language:[0],_OpenDoubleQuote:[1],_CloseDoubleQuote:[2],_OpenSingleQuote:[3],_CloseSingleQuote:[4]}],_10:[10],_11:[11],_LinguisticSettings:[15,{_PreferredProvider:[0],_LinguisticProviderInfo:[1]}],_13:[13],_UseSmartLists:[16],_DefaultStoryDir:[17],_18:[18],_GreekingSize:[20]}],_TextObjects:[1,{_Model:[0,{_Text:[0],_ParagraphRun:[5,{_RunArray:[0,{_RunData:[0,{_ParagraphSheet:[0,Y]}],_Length:[1]}]}],_StyleRun:[6,{_RunArray:[0,{_RunData:[0,{_StyleSheet:[0,Q]}],_Length:[1]}]}],_FirstKern:[7],_8:[8],_AlternateGlyphRun:[9,{_RunArray:[0,{_RunData:[0,{_AlternateGlyphSheet:[0,{_Glyph:[0],_Name:[1],_2:[2]}]}],_Length:[1]}]}],_StorySheet:[10,{_AntiAlias:[0],_1:[1],_UseFractionalGlyphWidths:[2],_3:[3],_4:[4]}],_KernRun:[15],_HyperlinkRun:[16]}],_View:[1,{_Frames:[0,{_Resource:[0]}],_RenderedData:[1,{_RunArray:[0,{_RunData:[0,{_0:[0],_LineCount:[1]}],_Length:[1]}]}],_Strikes:[2]}],_OpticalAlignment:[2]}],_OriginalNormalStyleFeatures:[2,$],_OriginalNormalParagraphFeatures:[3,J]}]},X=function(t,e,s){let i;if("string"==typeof t)return t;if(t instanceof Array){i=[];for(let s=0;s<t.length;s++)i[s]=X(t[s],e)}else{i={};const s={};for(const r in e){const n=e[r],a="_"+n[0];null!=t[a]&&(i[r]=n[1]?X(t[a],n[1]):t[a],s[a]=!0)}for(const e in t)if(null==s[e]){if(e.length>3)continue;throw"e"}}return i};const q={linkedLayer:F,unicodePath:class extends m{static shouldParse(t){return"pths"===t}parse(){return this.file.seek(4),this.data=new y(this.file).parse(),this}},textEngineData:class extends m{static shouldParse(t){return"Txt2"===t}constructor(t,e){super(t,e),this.textEngineData=null}parse(){const t=function(t){const e={};return K(t,e,0),e}(this.file.read(this.length));this.textEngineData=function(t){return X(t,Z)}(t)}export(){return{textEngineData:this.textEngineData}}},filterMask:class extends m{static shouldParse(t){return"FMsk"===t}constructor(t,e){super(t,e)}parse(){this.color=this.file.readSpaceColor(),this.opacity=this.file.readShort()}},patternsData:class extends m{static shouldParse(t){return["Patt","Pat2","Pat3"].includes(t)}constructor(t,e){super(t,e),this.length=e,this.patterns={}}readVirtualMemoryArrayList(){const{file:t}=this;t.seek(4,!0);const e=t.readInt()+t.tell(),s={top:t.readInt(),left:t.readInt(),bottom:t.readInt(),right:t.readInt(),channels:t.readInt(),data:[]};s.width=s.right-s.left,s.height=s.bottom-s.top;for(let i=0;i<s.channels+2;i++){let e=0,r=0;if(!t.readInt())continue;const n=t.readInt(),a=n+t.tell();t.readInt(),t.readInt(),t.readInt(),t.readInt(),t.readInt(),t.readShort();if(t.readByte()){const n=[];s.data[i]=new Uint8Array(s.width*s.height);for(let e=0;e<s.height;e++)n.push(t.readShort());for(let a=0;a<s.height;a++){const h=t.tell()+n[e+a];for(;t.tell()<h;){let e=t.read(1)[0];if(e<128){e+=1;const n=t.read(e);s.data[i].set(n,r),r+=e}else if(e>128){e^=255,e+=2;const n=t.read(1)[0];s.data[i].fill(n,r,r+e),r+=e}}}e+=s.height}else s.data[i]=new Uint8Array(t.read(n-23));t.seek(a)}return t.seek(e),s}readPattern(){const t=this.file,e=(t.readInt()+3&-4)+t.tell();t.readInt();const s=t.readInt(),i=[t.readShort(),t.readShort()],r={name:t.readUnicodeString(),id:t.readString(t.readByte()),mode:s,palette:[],width:i[1],height:i[0]};2===s&&(r.palette=t.read(768),t.seek(4,!0)),r.data=this.readVirtualMemoryArrayList(),this.patterns[r.id]=r,t.seek(e)}parse(){const t=this.file,e=this.length+t.tell();for(;t.tell()<e;)this.readPattern();t.seek(e)}}};class tt{constructor(t,e){this.file=t,this.header=e,this.layers=[],this.mergedAlpha=!1,this.globalMask=null,this.infoKeys=[],this.adjustments={},this.obj=this}skip(){this.file.seek(this.file.readInt(),!0)}parse(){let t;t=1===this.header.version?this.file.readInt():this.file.readLongLong(),this.layerEnd=t+this.file.tell(),t<=0||(this.parseLayers(),this.parseGlobalMask(),this.layers.reverse(),this.parseAdditionalLayerInformation(),this.assignGlobalEngineData(),this.file.seek(this.layerEnd))}parseLayers(){let t;t=1===this.header.version?s(this.file.readInt()):s(this.file.readLongLong());const e=this.file.tell()+t;if(t>0){let t=this.file.readShort();t<0&&(t=Math.abs(t),this.mergedAlpha=!0);for(let s=0;s<t;s++){const t=new z(this.file,this.header);t.parse(),this.layers.push(t)}const e=this.layers.length;for(let s=0;s<e;s++){this.layers[s].parseChannelImage()}}this.file.seek(e)}parseGlobalMask(){const t=this.file.readInt();if(t<=0)return;const e=s(this.file.tell()+t),i={};i.overlayColorSpace=this.file.readShort(),i.colorComponents=[this.file.readShort()>>8,this.file.readShort()>>8,this.file.readShort()>>8,this.file.readShort()>>8],i.opacity=this.file.readShort()/16,i.kind=this.file.readByte(),this.globalMask=i,this.file.seek(e)}parseAdditionalLayerInformation(){for(;this.file.tell()<this.layerEnd;){this.file.seek(4,!0);const t=this.file.readString(4),e=s(this.file.readInt());if(this.file.tell(),e<=0)continue;let i=!1;for(const s in q){const r=q[s];if(!r.shouldParse(t))continue;const n=new r(this,e);this.adjustments[s]=new g(n,this.file).now("skip").later("parse").get(),null==this[s]&&(this[s]=()=>this.adjustments[s]),this.infoKeys.push(t),i=!0;break}i||this.file.seek(e,!0)}}assignGlobalEngineData(){var t,e,s,i;const r=null==(e=null==(t=this.adjustments)?void 0:t.textEngineData)?void 0:e.textEngineData,n=null==(i=null==(s=null==r?void 0:r._DocumentResources)?void 0:s._TextFrameSet)?void 0:i._Resources;if(!n||!this.layers.length)return;let a=n.length-1;this.layers.forEach((t=>{var e,s;const i=null==(s=null==(e=t.adjustments)?void 0:e.typeTool)?void 0:s.engineData;i&&(i.curve=n[a--])}))}parseLayerInfo(){throw new Error("layerMask.parseLayerInfo is not implemented")}}class et{constructor(t){this.resource=t,this.file=this.resource.file,this.start=this.file.pos,this.end=this.start+this.resource.length}parse(){return this.data=this.file.data.subarray(this.start,this.end),this.data}}et.prototype.id=1039,et.prototype.name="icc profile";class st{static visibilityCaptured(t){return t.capturedInfo&parseInt("001",2)>0}static positionCaptured(t){return t.positionCaptured&parseInt("010",2)>0}static appearanceCaptured(t){return t.appearanceCaptured&parseInt("100",2)>0}constructor(t){this.resource=t,this.file=this.resource.file}parse(){return this.file.seek(4,!0),this.data=new y(this.file).parse(),this.data}names(){return this.data.list.map((t=>t["Nm  "]))}export(){return this.data.list.map((t=>({id:t.compID,name:t["Nm  "],capturedInfo:t.capturedInfo})))}}st.prototype.id=1065,st.prototype.name="layerComps";let it=class{constructor(t){this.resource=t,this.file=this.resource.file}parse(){return this.angle=this.file.readInt(),this.angle}};it.prototype.id=1037,it.prototype.name="globalLightAngle";class rt{constructor(t){this.resource=t,this.file=this.resource.file}parse(){return this.altitude=this.file.readInt(),this.altitude}}rt.prototype.id=1049,rt.prototype.name="globalLightAngle";class nt{constructor(t){this.resource=t,this.file=this.resource.file}parse(){return this.file.seek(4,!0),this.data=new y(this.file).parse(),this.data}}nt.prototype.id=3e3,nt.prototype.name="originPathInfo";class at{constructor(t){this.resource=t,this.file=this.resource.file}parse(){return this.file.seek(4,!0),this.data=new y(this.file).parse(),this.data}}at.prototype.id=1088,at.prototype.name="pathSelection";class ht{constructor(t){this.resource=t,this.file=this.resource.file,this.paths=[]}parse(){const t=this.resource.length/26;for(let e=0;e<t;e++){const t=new M(this.file);t.parse(),this.paths.push(t)}}export(){return this.paths}}ht.prototype.id=2e3,ht.prototype.name="path";class lt{constructor(t){this.resource=t,this.file=this.resource.file}parse(){this.format=this.file.readString(4),this.width=this.file.readInt(),this.height=this.file.readInt(),this.widthBytes=this.file.readInt(),this.totalSize=this.file.readInt(),this.compressedSize=this.file.readInt(),this.bitsPerPixel=this.file.readShort(),this.numberOfPlanes=this.file.readShort(),this.jfif=this.file.read(this.compressedSize),this.binaryString=String.fromCharCode.apply(null,this.jfif)}}lt.prototype.id=1036,lt.prototype.name="thumbnail";class ot{constructor(t){this.resource=t,this.file=this.resource.file,this.linkArray=[]}parse(){const t=this.file.tell()+this.resource.length;for(;t>this.file.tell();)this.linkArray.push(this.file.readShort());return this.linkArray.reverse(),this.linkArray}}ot.prototype.id=1026,ot.prototype.name="LinkLayers";class ct{constructor(t){this.resource=t,this.file=this.resource.file}parse(){return this.h_res=this.file.readUInt()/65536,this.h_res_unit=this.file.readUShort(),this.width_unit=this.file.readUShort(),this.v_res=this.file.readUInt()/65536,this.v_res_unit=this.file.readUShort(),this.height_unit=this.file.readUShort(),this.resource.data={h_res:this.h_res,h_res_unit:this.h_res_unit,width_unit:this.width_unit,v_res:this.v_res,v_res_unit:this.v_res_unit,height_unit:this.height_unit},this.resource.data}export(){const t={},e=["h_res","h_res_unit","width_unit","v_res","v_res_unit","height_unit"],s=e.length;for(let i=0;i<s;i++){const s=e[i];t[s]=this[s]}return t}}ct.prototype.id=1005,ct.prototype.name="resolutionInfo";class dt{constructor(t){this.resource=t,this.file=this.resource.file,this.data=[]}parse(){this.file.seek(4,!0),this.file.seek(8,!0);const t=this.file.readInt();for(let e=0;e<t;e++){const t=(this.file.readInt()/32).toFixed(1),e=this.file.readByte()?"horizontal":"vertical";this.data.push({location:t,direction:e})}}export(){return this.data}}dt.prototype.id=1032,dt.prototype.name="guides";class ut{constructor(t){this.resource=t,this.file=this.resource.file}parse(){return this.xmp=this.file.read(this.resource.length),this.xmp}}ut.prototype.id=1060,ut.prototype.name="xmp";class ft{constructor(t){this.resource=t,this.file=this.resource.file}parse(){this.file.seek(4,!0),this.data=new y(this.file).parse()}}ft.prototype.id=1075,ft.prototype.name="timeline";class pt{constructor(t){this.resource=t,this.file=this.resource.file,this.paths=[]}parse(){const t=(this.resource.length-10)/26;for(let e=0;e<t;e++){const t=new M(this.file);t.parse(),this.paths.push(t)}}}pt.prototype.id=1025,pt.prototype.name="WorkingPath";const gt=[et,st,it,rt,nt,at,ht,lt,ot,ct,dt,ut,ft,pt];class yt{constructor(t){this.file=t,this.id=null,this.type=null,this.length=0}parse(){this.type=this.file.readString(4),this.id=this.file.readShort();const t=s(this.file.readByte()+1)-1;this.name=this.file.readString(t),this.length=s(this.file.readInt())}}yt.Section=class{static factory(t){const e=gt.length;for(let s=0;s<e;s++){const e=gt[s];if(e.prototype.id===t.id||t.id>=2e3&&t.id<2998&&2e3===e.prototype.id){const s=new e(t);return s.parse(),s}}return null}};class mt{constructor(t){this.file=t,this.resources={},this.typeIndex={},this.length=null}skip(){this.length=this.file.readInt(),this.file.seek(this.length,!0)}parse(){this.length=this.file.readInt();const t=this.length+this.file.tell();for(;this.file.tell()<t;){const t=new yt(this.file);t.parse();const e=this.file.tell()+t.length,s=yt.Section.factory(t);null!=s?(this.resources[s.id]=s,null!=s.name&&(this.typeIndex[s.name]=s.id),this.file.seek(e)):this.file.seek(e)}this.file.seek(t)}resource(t){return"string"==typeof t?this.byType(t):this.resources[t]}byType(t){return this.resources[this.typeIndex[t]]}load(){}}class _t{constructor(t,s){e(this,"type","node"),this.parent=s,this.layer=t,this.layer.node=this,this._children=[],this.name=this.layer.name,this.forceVisible=null,this.coords={top:this.layer.top,bottom:this.layer.bottom,left:this.layer.left,right:this.layer.right},this.topOffset=0,this.leftOffset=0,this.createProperties()}createProperties(){return Object.defineProperty(this,"top",{get:function(){return this.coords.top+this.topOffset},set:function(t){return this.coords.top=t}}),Object.defineProperty(this,"right",{get:function(){return this.coords.right+this.leftOffset},set:function(t){return this.coords.right=t}}),Object.defineProperty(this,"bottom",{get:function(){return this.coords.bottom+this.topOffset},set:function(t){return this.coords.bottom=t}}),Object.defineProperty(this,"left",{get:function(){return this.coords.left+this.leftOffset},set:function(t){return this.coords.left=t}}),Object.defineProperty(this,"width",{get:function(){return this.right-this.left}}),Object.defineProperty(this,"height",{get:function(){return this.bottom-this.top}})}get(t){const e=null!=this[t]?this[t]:this.layer[t];return"function"==typeof e?e():e}visible(){return!(this.layer.clipped&&!this.clippingMask().visible())&&(null!=this.forceVisible?this.forceVisible:this.layer.visible)}hidden(){return!this.visible()}isLayer(){return"layer"===this.type}isGroup(){return"group"===this.type}isRoot(){return"root"===this.type}clippingMask(){if(!this.layer.clipped)return null;if(!this.clippingMaskCached){let t=this.nextSibling();for(;t.clipped;)t=t.nextSibling();this.clippingMaskCached=t}return this.clippingMaskCached}clippedBy(){return this.clippingMask()}export(){const t={type:null,visible:this.visible(),opacity:this.layer.opacity/255,blendingMode:this.layer.blendingMode()},e=_t.PROPERTIES,s=e.length;for(let i=0;i<s;i++){const s=e[i];t[s]=this[s]}return t}updateDimensions(){if(this.isLayer())return;const t=this._children,e=t.length;for(let i=0;i<e;i++){t[i].updateDimensions()}if(this.isRoot())return;const s=this._children.filter((t=>!t.isEmpty()));this.left=Math.min.call(null,s.map((t=>t.left)))||0,this.top=Math.min.call(null,s.map((t=>t.top)))||0,this.bottom=Math.max.call(null,s.map((t=>t.bottom)))||0,this.right=Math.max.call(null,s.map((t=>t.right)))||0}root(){return this.isRoot()?this:this.parent.root()}children(){return this._children}ancestors(){return null==this.parent||this.parent.isRoot()?[]:this.parent.ancestors().concat([this.parent])}hasChildren(){return this._children.length>0}childless(){return!this.hasChildren()}siblings(){return null==this.parent?[]:this.parent.children()}nextSibling(){if(null==this.parent)return null;const t=this.siblings().indexOf(this);return this.siblings()[t+1]}prevSibling(){if(null==this.parent)return null;const t=this.siblings().indexOf(this);return this.siblings()[t-1]}hasSiblings(){return this.siblings().length>1}onlyChild(){return!this.hasSiblings()}descendants(){return this._children.map((t=>t.subtree())).flat()}subtree(){return[this].concat(this.descendants())}depth(){return this.ancestors().length+1}path(t=!1){const e=this.ancestors().map((function(t){return t.name})).concat([this.name]);return t?e:e.join("/")}toPng(){return this.layer.image.toPng()}saveAsPng(t){return this.layer.image.saveAsPng(t)}childrenAtPath(t,e={}){Array.isArray(t)||(t=t.split("/").filter((t=>t.length>0)));const s=(t=[...t]).shift(),i=this.children().filter((function(t){return e.caseSensitive?t.name===s:t.name.toLowerCase()===s.toLowerCase()}));return 0===t.length?i:i.map((s=>s.childrenAtPath([...t],e))).flat()}}_t.PROPERTIES=["name","left","right","top","bottom","height","width"];class bt extends _t{constructor(){super(...arguments),e(this,"type","group")}passthruBlending(){return"passthru"===this.get("blendingMode")}isEmpty(){const t=this._children,e=t.length;for(let s=0;s<e;s++){if(!t[s].isEmpty())return!1}return!0}export(){const t=super.export();return t.type="group",t.children=this._children.map((function(t){return t.export()})),t}}class St extends _t{constructor(){super(...arguments),e(this,"type","layer")}hasMask(){if(!this.layer.adjustments)return!1;const t=this.layer.adjustments.vectorMask,e=this.layer.adjustments.vectorStroke;return t||e}isEmpty(){return(0===this.width||0===this.height)&&!this.hasMask()}export(){const t=this.get("typeTool"),e=super.export();return e.type="layer",e.mask=this.layer.mask.export(),e.text=t?t.export():void 0,e.image={},e}}class kt extends _t{constructor(t){super(kt.layerForPsd(t)),e(this,"type","root"),this.psd=t,this.buildHierarchy()}static layerForPsd(t){const e={},s=_t.PROPERTIES,i=s.length;for(let r=0;r<i;r++){e[s[r]]=null}return e.top=0,e.left=0,e.right=t.header.width,e.bottom=t.header.height,e}documentDimensions(){return[this.width,this.height]}depth(){return 0}opacity(){return 255}fillOpacity(){return 255}export(){const t=this.psd.resources.resource("layerComps"),e=this.psd.resources.resource("resolutionInfo"),s=this.psd.resources.resource("guides");return{children:this._children.map((t=>t.export())),document:{width:this.width,height:this.height,resources:{layerComps:t?t.export():[],resolutionInfo:e?e.export():[],guides:s?s.export():null,slices:[]}}}}buildHierarchy(){let t=this;const e=[],s=this.psd.layers,i=s.length;for(let r=0;r<i;r++){const i=s[r];if(i.isFolder()){e.push(t);const s=e[e.length-1];t=new bt(i,s)}else if(i.isFolderEnd()&&e.length){const s=e.pop();s.children().push(t),t=s}else t.children().push(new St(i,t))}this.updateDimensions()}}const It=function(t){t.fromURL=function(e){return new Promise((function(s,i){const r=new XMLHttpRequest;return r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){const e=new Uint8Array(r.response||r.mozResponseArrayBuffer);try{const i=new t(e);i.parse(),s(i)}catch(n){return i(n)}},r.send(null)}))},t.fromEvent=function(e){return new Promise((function(s,i){const r=e.dataTransfer.files[0],n=new FileReader;return n.onload=function(e){try{const i=new t(new Uint8Array(e.target.result));i.parse(),s(i)}catch(r){i(r)}},n.onerror=i,n.readAsArrayBuffer(r)}))},t.fromDroppedFile=function(e){return new Promise((function(s,i){const r=new FileReader;r.onload=function(e){try{const i=new t(new Uint8Array(e.target.result));i.parse(),s(i)}catch(r){i(r)}},r.onerror=i,r.readAsArrayBuffer(e)}))}};class Pt{constructor(t){this.file=new l(t),this.parsed=!1,this.header=null,Object.defineProperty(this,"layers",{get:function(){return this.layerMask.layers}})}parse(){this.parsed||(this.parseHeader(),this.parseResources(),this.parseLayerMask(),this.parseImage(),this.parsed=!0)}parseHeader(){this.header=new c(this.file),this.header.parse()}parseResources(){const t=new mt(this.file);t.parse(),this.resources=t}parseLayerMask(){const t=new tt(this.file,this.header);t.parse(),this.layerMask=t}parseImage(){const t=new u(this.file,this.header);t.parse(),this.image=t}tree(){return new Pt.Node.Root(this)}setColorConverters(){a.setColorConverters(...arguments)}}Pt.Node={Root:kt},It(Pt);export{Pt as default};
